Object.defineProperty(exports,"__esModule",{value:!0});var e=require("graphql"),t=require("./74ef17d1.min.js"),r=require("wonka");const n=(e,t)=>{if(Array.isArray(e))for(const r of e)n(r,t);else if("object"==typeof e&&null!==e)for(const r in e)"__typename"===r&&"string"==typeof e[r]?t.add(e[r]):n(e[r],t);return t},o=t=>{if(!t.selectionSet)return t;for(const r of t.selectionSet.selections)if(r.kind===e.Kind.FIELD&&"__typename"===r.name.value&&!r.alias)return t;return{...t,selectionSet:{...t.selectionSet,selections:[...t.selectionSet.selections,{kind:e.Kind.FIELD,name:{kind:e.Kind.NAME,value:"__typename"}}]}}},s=new Map,i=r=>{const n=t.keyDocument(r);let i=s.get(n.__key);return i||(i=e.visit(n,{Field:o,InlineFragment:o}),Object.defineProperty(i,"__key",{value:n.__key,enumerable:!1}),s.set(n.__key,i)),i},a=e=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map(a);if(e&&"object"==typeof e&&"__typename"in e){const t={};for(const r in e)"__typename"===r?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[r]=a(e[r]);return t}return e}return e};function c(e){return e.toPromise=()=>new Promise((t=>{const n=r.subscribe((e=>{e.stale||e.hasNext||Promise.resolve().then((()=>{n.unsubscribe(),t(e)}))}))(e)})),e}function u(e,t,r){return r||(r=t.context),{key:t.key,query:t.query,variables:t.variables,kind:e,context:r}}const l=(e,t)=>u(e.kind,e,{...e.context,meta:{...e.context.meta,...t}}),p=()=>{},d=(r,n,o)=>{for(const s of o)if(s.kind===e.Kind.FRAGMENT_DEFINITION){const e=s.name.value,o=t.stringifyDocument(s);r.has(e)||(r.set(e,o),n.push(s))}else n.push(s)},y=({kind:e})=>"mutation"!==e&&"query"!==e,k=({forward:e,client:t})=>{const o=new Map,s=new Map,a=e=>{const t=u(e.kind,e);return t.query=i(e.query),t},c=e=>{const{key:t,kind:r,context:{requestPolicy:n}}=e;return"query"===r&&"network-only"!==n&&("cache-only"===n||o.has(t))};return i=>{const u=r.share(i),p=r.map((e=>{const r=o.get(e.key),n={...r,operation:l(e,{cacheOutcome:r?"hit":"miss"})};return"cache-and-network"===e.context.requestPolicy&&(n.stale=!0,f(t,e)),n}))(r.filter((e=>!y(e)&&c(e)))(u)),d=r.tap((e=>{let{operation:r}=e;if(!r)return;const i=(e=>[...n(e,new Set)])(e.data).concat(r.context.additionalTypenames||[]);if("mutation"===e.operation.kind){const e=new Set;for(let t=0;t<i.length;t++){const r=i[t];let n=s.get(r);n||s.set(r,n=new Set);for(const t of n.values())e.add(t);n.clear()}for(const n of e.values())o.has(n)&&(r=o.get(n).operation,o.delete(n),f(t,r))}else if("query"===r.kind&&e.data){o.set(r.key,e);for(let e=0;e<i.length;e++){const t=i[e];let n=s.get(t);n||s.set(t,n=new Set),n.add(r.key)}}}))(e(r.filter((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(r.map((e=>l(e,{cacheOutcome:"miss"})))(r.merge([r.map(a)(r.filter((e=>!y(e)&&!c(e)))(u)),r.filter((e=>y(e)))(u)])))));return r.merge([p,d])}},f=(e,t)=>e.reexecuteOperation(u(t.kind,t,{...t.context,requestPolicy:"network-only"})),m=new Set,x=({forward:e})=>{const t=new Set,n=e=>{const{key:r,kind:n}=e;if("teardown"===n||"mutation"===n)return t.delete(r),!0;const o=t.has(r);return t.add(r),!o},o=({operation:e,hasNext:r})=>{r||t.delete(e.key)};return t=>{const s=r.filter(n)(t);return r.tap(o)(e(s))}},h=({forward:e})=>n=>{const o=r.share(n),s=r.mergeMap((e=>{const{key:n}=e,s=t.makeFetchBody(e),i=t.makeFetchURL(e,s),a=t.makeFetchOptions(e,s);return r.takeUntil(r.filter((e=>"teardown"===e.kind&&e.key===n))(o))(t.makeFetchSource(e,i,a))}))(r.filter((e=>"query"===e.kind||"mutation"===e.kind))(o)),i=e(r.filter((e=>"query"!==e.kind&&"mutation"!==e.kind))(o));return r.merge([s,i])},g=({})=>e=>r.filter((()=>!1))(r.tap((e=>{}))(e)),b=g({dispatchDebug:p}),q=e=>({client:t,forward:r})=>e.reduceRight(((e,r)=>r({client:t,forward:e,dispatchDebug(e){}})),r),w=[x,k,h],E=function e(n){const o=new Map,s=new Map,i=[],l={url:n.url,fetchOptions:n.fetchOptions,fetch:n.fetch,preferGetMethod:!!n.preferGetMethod,requestPolicy:n.requestPolicy||"cache-first"},{source:d,next:y}=r.makeSubject();let k=!1;function f(e){if(e&&y(e),!k){for(k=!0;k&&(e=i.shift());)y(e);k=!1}}const m=e=>{let t=r.filter((t=>t.operation.kind===e.kind&&t.operation.key===e.key&&(!t.operation.context._instance||t.operation.context._instance===e.context._instance)))(O);return n.maskTypename&&(t=r.map((e=>({...e,data:a(e.data)})))(t)),"mutation"===e.kind?r.take(1)(r.onStart((()=>y(e)))(t)):r.share(r.onEnd((()=>{o.delete(e.key),s.delete(e.key);for(let t=i.length-1;t>=0;t--)i[t].key===e.key&&i.splice(t,1);y(u("teardown",e,e.context))}))(r.onPush((t=>{o.set(e.key,t)}))(r.switchMap((t=>"query"!==e.kind||t.stale?r.fromValue(t):r.merge([r.fromValue(t),r.map((()=>({...t,stale:!0})))(r.take(1)(r.filter((t=>"query"===t.kind&&t.key===e.key&&"cache-only"!==t.context.requestPolicy))(d)))])))(r.takeUntil(r.filter((t=>"teardown"===t.kind&&t.key===e.key))(d))(t)))))},x=this instanceof e?this:Object.create(e.prototype),h=Object.assign(x,{suspense:!!n.suspense,operations$:d,reexecuteOperation(e){("mutation"===e.kind||s.has(e.key))&&(i.push(e),Promise.resolve().then(f))},createRequestOperation:(e,r,n)=>(n||(n={}),t.getOperationType(r.query),u(e,r,{_instance:"mutation"===e?[]:void 0,...l,...n,suspense:n.suspense||!1!==n.suspense&&h.suspense})),executeRequestOperation:e=>"mutation"===e.kind?m(e):r.make((t=>{let n=s.get(e.key);n||s.set(e.key,n=m(e));const i="cache-and-network"===e.context.requestPolicy||"network-only"===e.context.requestPolicy;return r.subscribe(t.next)(r.onEnd((()=>{k=!1,t.complete()}))(r.onStart((()=>{const r=o.get(e.key);if("subscription"===e.kind)return f(e);i&&f(e),null!=r&&r===o.get(e.key)?t.next(i?{...r,stale:!0}:r):i||f(e)}))(n))).unsubscribe})),executeQuery(e,t){const r=h.createRequestOperation("query",e,t);return h.executeRequestOperation(r)},executeSubscription(e,t){const r=h.createRequestOperation("subscription",e,t);return h.executeRequestOperation(r)},executeMutation(e,t){const r=h.createRequestOperation("mutation",e,t);return h.executeRequestOperation(r)},query:(e,r,n)=>(n&&"boolean"==typeof n.suspense||(n={...n,suspense:!1}),c(h.executeQuery(t.createRequest(e,r),n))),readQuery(e,t,n){let o=null;return r.subscribe((e=>{o=e}))(h.query(e,t,n)).unsubscribe(),o},subscription:(e,r,n)=>h.executeSubscription(t.createRequest(e,r),n),mutation:(e,r,n)=>c(h.executeMutation(t.createRequest(e,r),n))});let b=p;const E=q(void 0!==n.exchanges?n.exchanges:w),O=r.share(E({client:h,dispatchDebug:b,forward:g({dispatchDebug:b})})(d));return r.publish(O),h},O=E;exports.CombinedError=t.CombinedError,exports.createRequest=t.createRequest,exports.getOperationName=t.getOperationName,exports.makeErrorResult=t.makeErrorResult,exports.makeResult=t.makeResult,exports.mergeResultPatch=t.mergeResultPatch,exports.stringifyVariables=t.stringifyVariables,exports.Client=E,exports.cacheExchange=k,exports.composeExchanges=q,exports.createClient=O,exports.debugExchange=({forward:e})=>t=>e(t),exports.dedupExchange=x,exports.defaultExchanges=w,exports.errorExchange=({onError:e})=>({forward:t})=>n=>r.tap((({error:t,operation:r})=>{t&&e(t,r)}))(t(n)),exports.fallbackExchangeIO=b,exports.fetchExchange=h,exports.formatDocument=i,exports.gql=function(){const r=new Map,n=[],o=[];let s=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"";for(let e=1;e<arguments.length;e++){const t=arguments[e];t&&t.definitions?o.push(...t.definitions):s+=t,s+=arguments[0][e]}return d(r,n,t.keyDocument(s).definitions),d(r,n,o),t.keyDocument({kind:e.Kind.DOCUMENT,definitions:n})},exports.makeOperation=u,exports.maskTypename=a,exports.ssrExchange=(e={})=>{const n=!!e.staleWhileRevalidate,o=!!e.includeExtensions,s={},i=[],a=e=>{i.push(e.operation.key),1===i.length&&Promise.resolve().then((()=>{let e;for(;e=i.shift();)s[e]=null}))},c=({client:i,forward:c})=>u=>{const l=e&&"boolean"==typeof e.isClient?!!e.isClient:!i.suspense,p=r.share(u);let d=c(r.filter((e=>!s[e.key]||!!s[e.key].hasNext))(p)),y=r.map((e=>{const r=((e,r,n)=>({operation:e,data:r.data?JSON.parse(r.data):void 0,extensions:n&&r.extensions?JSON.parse(r.extensions):void 0,error:r.error?new t.CombinedError({networkError:r.error.networkError?new Error(r.error.networkError):void 0,graphQLErrors:r.error.graphQLErrors}):void 0,hasNext:r.hasNext}))(e,s[e.key],o);return n&&!m.has(e.key)&&(r.stale=!0,m.add(e.key),f(i,e)),r}))(r.filter((e=>!!s[e.key]&&"network-only"!==e.context.requestPolicy))(p));return l?y=r.tap(a)(y):d=r.tap((e=>{const{operation:t}=e;if("mutation"!==t.kind){const r=(({hasNext:e,data:t,extensions:r,error:n},o)=>{const s={};return void 0!==t&&(s.data=JSON.stringify(t)),o&&void 0!==r&&(s.extensions=JSON.stringify(r)),e&&(s.hasNext=!0),n&&(s.error={graphQLErrors:n.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},n.networkError&&(s.error.networkError=""+n.networkError)),s})(e,o);s[t.key]=r}}))(d),r.merge([d,y])};return c.restoreData=e=>{for(const t in e)null!==s[t]&&(s[t]=e[t])},c.extractData=()=>{const e={};for(const t in s)null!=s[t]&&(e[t]=s[t]);return e},e&&e.initialState&&c.restoreData(e.initialState),c},exports.subscriptionExchange=({forwardSubscription:n,enableAllOperations:o,isSubscriptionOperation:s})=>({client:i,forward:a})=>{const c=s||(e=>{const{kind:t}=e;return"subscription"===t||!!o&&("query"===t||"mutation"===t)});return o=>{const s=r.share(o),l=r.mergeMap((o=>{const{key:a}=o,c=r.filter((e=>"teardown"===e.kind&&e.key===a))(s);return r.takeUntil(c)((o=>{const s=n({key:o.key.toString(36),query:e.print(o.query),variables:o.variables,context:{...o.context}});return r.make((({next:e,complete:r})=>{let n,a=!1;return Promise.resolve().then((()=>{a||(n=s.subscribe({next:r=>e(t.makeResult(o,r)),error:r=>e(t.makeErrorResult(o,r)),complete:()=>{a||(a=!0,"subscription"===o.kind&&i.reexecuteOperation(u("teardown",o,o.context)),r())}}))})),()=>{a=!0,n&&n.unsubscribe()}}))})(o))}))(r.filter(c)(s)),p=a(r.filter((e=>!c(e)))(s));return r.merge([l,p])}};
//# sourceMappingURL=urql-core.min.js.map
